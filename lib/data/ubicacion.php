<?php

    $comunas = array(
        'Comuna 1', 'Comuna 2', 'Comuna 3', 'Comuna 4', 'Comuna 5',
        'Comuna 6', 'Comuna 7', 'Comuna 8', 'Comuna 9', 'Comuna 10',
        'Comuna 11', 'Comuna 12', 'Comuna 13', 'Comuna 14', 'Comuna 15',
        'Comuna 16', 'Comuna 17', 'Comuna 18', 'Comuna 19', 'Comuna 20',
        'Comuna 21', 'Comuna 22'
    );

    $barrios = array(
        '20 de Julio',
        '3 de Julio',
        'Aguablanca',
        'Aguacatal',
        'Alameda',
        'Alfonso Barberena A.',
        'Alfonso Bonilla Aragón',
        'Alfonso López P. 1a. Etapa',
        'Alfonso López P. 2a. Etapa',
        'Alfonso López P. 3a. Etapa',
        'Alférez Real',
        'Alirio Mora Beltrán',
        'Alto Nápoles',
        'Altos de Menga',
        'Altos de Santa Isabel -  La Morelia',
        'Antonio Nariño',
        'Aranjuez',
        'Arboledas',
        'Asturias',
        'Atanasio Girardot',
        'Base Aérea',
        'Barrio Caldas',
        'Barrio Departamental',
        'Barrio Eucarístico',
        'Barrio Obrero',
        'Belalcázar',
        'Belén',
        'Belisario Caicedo',
        'Bellavista',
        'Bello Horizonte',
        'Benjamín Herrera',
        'Bolivariano',
        'Bosques del Limonar',
        'Bretaña',
        'Brisas de Mayo',
        'Brisas de los Alamos',
        'Buenos Aires',
        'Calima',
        'Calimio Desepaz',
        'Calipso',
        'Caminos Real - Joaquín Borrero Sinisterra',
        'Caminos Real - Los Fundadores',
        'Caney',
        'CaÑaveral',
        'CaÑaveralejo - Seguros Patria',
        'CaÑaverales - Los Samanes',
        'Centenario',
        'Chapinero',
        'Charco Azul',
        'Chiminangos Primera Etapa',
        'Chiminangos Segunda Etapa',
        'Chipichape',
        'Ciudad 2000',
        'Ciudad Capri',
        'Ciudad Cordoba',
        'Ciudad Los Alamos',
        'Ciudad Universitaria',
        'Ciudad Campestre',
        'Ciudad Talanga',
        'Ciudadela Comfandi',
        'Ciudadela Floralia',
        'Ciudadela Pasoancho',
        'Ciudadela del Río',
        'Club Campestre',
        'Colinas del Sur',
        'Colseguros Andes',
        'Comuna I',
        'Comuneros I',
        'Compartir',
        'Cristóbal Colón',
        'Cuarteles Napoles',
        'Cuarto de Legua - Guadalupe',
        'Desepaz Invicali',
        'Doce de Octubre',
        'El Alcázar',
        'El Angel del Hogar',
        'El Bosque',
        'El Calvario',
        'El Cedro',
        'El Cortijo',
        'El Diamante',
        'El Dorado',
        'El Gran Limonar',
        'El Gran Limonar - Cataya',
        'El Guabal',
        'El Hoyo',
        'El Ingenio',
        'El Jardín',
        'El Jordán',
        'El Lido',
        'El Limonar',
        'El Mortiñal',
        'El Morichal',
        'El Nacional',
        'El Paraiso',
        'El Peñón',
        'El Piloto',
        'El Poblado I',
        'El Poblado II',
        'El Pondaje',
        'El Prado',
        'El Refugio',
        'El Remanso',
        'El Retiro',
        'El Rodeo',
        'El Sena',
        'El Troncal',
        'El Vallado',
        'El Vergel',
        'EL Trébol',
        'Eduardo Santos',
        'Evaristo García',
        'Fátima',
        'Fenalco Kennedy',
        'Fepicol',
        'Flora Industrial',
        'Fonaviemcali',
        'Francisco Eladio Ramirez',
        'Granada',
        'Guayaquil',
        'Guillermo Valencia',
        'Horizontes',
        'Ignacio Rengifo',
        'Industria de Licores',
        'Industrial',
        'Jorge Eliecer Gaitán',
        'Jorge Isaacs',
        'Jorge Zawadsky',
        'José Holguín Garcés',
        'José Manuel Marroquín Primera Etapa',
        'José Manuel Marroquín Segunda Etapa',
        'José María Cordoba',
        'Juanambú',
        'Julio Rincón',
        'Junín',
        'La Alborada',
        'La Alianza',
        'La Base',
        'La Campiña',
        'La Cascada',
        'La Esmeralda',
        'La Esperanza',
        'La Floresta',
        'La Flora',
        'La Fortaleza',
        'La Gran Colombia',
        'La Hacienda',
        'La Independencia',
        'La Isla',
        'La Libertad',
        'La Merced',
        'La Paz',
        'La Playa',
        'La Rivera Primera Etapa',
        'La Sultana',
        'La Selva',
        'La Sultana',
        'La Campiña',
        'Laureano Gómez',
        'Las Acacias',
        'Las Américas',
        'Las Ceibas',
        'Las Delicias',
        'Las Granjas',
        'Las Orquídeas',
        'Las Quintas de Don Simón',
        'León XIII',
        'Lili',
        'Lleras Camargo',
        'Lleras Restrepo',
        'Lleras Restrepo II Etapa',
        'Los Alcázares',
        'Los Andes',
        'Los Andes B - La Riviera',
        'Los Cambulos',
        'Los Chorros',
        'Los Comuneros Segunda Etapa',
        'Los Conquistadores',
        'Los Farallones',
        'Los Guaduales',
        'Los Guayacanes',
        'Los Lagos',
        'Los Libertadores',
        'Los Líderes',
        'Los Naranjos I',
        'Los Naranjos II',
        'Los Parques - Barranquilla',
        'Los Pinos',
        'Los Portales - Nuevo Rey',
        'Los Robles',
        'Los Sauces',
        'Lourdes',
        'Manzanares',
        'Manuel María Buenaventura',
        'Maracaibo',
        'Mariano Ramos',
        'Marroquín III',
        'Marco Fidel Suárez',
        'Mario Correa Rengifo',
        'Mayapan - Las Vegas',
        'Meléndez',
        'Menga',
        'Metropolitano del Norte',
        'Miraflores',
        'Mojica',
        'Municipal',
        'Nápoles',
        'Navarro - La Chanca',
        'Nueva Floresta',
        'Nueva Tequendama',
        'Olaya Herrera',
        'Olímpico',
        'Omar Torrijos',
        'Pampa Linda',
        'Panamericano',
        'Parque de la Caña',
        'Parcelaciones Pance',
        'Paso del Comercio',
        'Pasoancho',
        'Paseo de Los Almendros',
        'Petecuy Primera Etapa',
        'Petecuy Segunda Etapa',
        'Petecuy Tercera Etapa',
        'Pízamos I',
        'Pízamos II',
        'Pízamos III - Las Dalias',
        'Planta de Tratamiento',
        'Polvorines',
        'Popular',
        'Porvenir',
        'Potrero Grande',
        'Primavera',
        'Primero de Mayo',
        'Primitivo Crespo',
        'Prados de Oriente',
        'Prados del Limonar',
        'Prados del Norte',
        'Prados del Sur',
        'Promociones Populares B',
        'Puerta del Sol',
        'Puerto Mallarino',
        'Puerto Nuevo',
        'Pueblo Joven',
        'República de Israel',
        'Ricardo Balcázar',
        'Rodrigo Lara Bonilla',
        'Salomia',
        'San Antonio',
        'San Benito',
        'San Carlos',
        'San Cayetano',
        'San Cristobal',
        'San Fernando Nuevo',
        'San Fernando Viejo',
        'San Juan Bosco',
        'San Judas Tadeo I Etapa',
        'San Judas Tadeo II Etapa',
        'San Luís',
        'San Luís II',
        'San Marino',
        'San Nicolás',
        'San Pascual',
        'San Pedro',
        'San Pedro Claver',
        'San Vicente',
        'Santa Anita - La Selva',
        'Santa Barbara',
        'Santa Elena',
        'Santa Fe',
        'Santa Isabel',
        'Santa Mónica',
        'Santa Mónica Belalcázar',
        'Santa Mónica Popular',
        'Santa Rita',
        'Santa Rosa',
        'Santander',
        'Santo Domingo',
        'Salomia',
        'Salomia',
        'Saavedra Galindo',
        'Sector Alto Jordán',
        'Sector Alto de Los Chorros',
        'Sector Altos Normandía',
        'Sector Asprosocial-Diamante',
        'Sector Cañaveralejo Guadalupe',
        'Sector Laguna del Pondaje',
        'Sector Meléndez',
        'Sector Patio Bonito',
        'Sector Puente del Comercio',
        'Senderos de la Flora',
        'Siete de Agosto',
        'Siloé',
        'Sindical',
        'Simón Bolívar',
        'Sultana - Berlín - San Francisco',
        'Sucre',
        'Tejares - Cristales',
        'Tierra Blanca',
        'Torres de Comfandi',
        'U.D. Alberto Galindo -  Plaza de Toros',
        'Unidad Residencial Bueno Madrid',
        'Unidad Residencial El Coliseo',
        'Unidad Residencial Santiago de Cali',
        'Unicentro Cali',
        'Unión de Vivienda Popular',
        'Urbanización Boyacá',
        'Urbanización Calimio',
        'Urbanización Ciudad Jardín',
        'Urbanización Colseguros',
        'Urbanización La Flora',
        'Urbanización La Merced',
        'Urbanización La Nueva Base',
        'Urbanización Militar',
        'Urbanización Nueva Granada',
        'Urbanización Río Lili',
        'Urbanización San Joaquin',
        'Urbanización Tequendama',
        'Ulpiano Lloreda',
        'Uribe Uribe',
        'Valle Grande',
        'Vendimia',
        'Venezuela - Urbanización Cañaveralejo',
        'Versalles',
        'Villa Colombia',
        'Villa del Lago',
        'Villa del Prado - El Guabito',
        'Villa del Sol',
        'Villa del Sur',
        'Villablanca',
        'Villamercedes I - Villa Luz - Las Garzas',
        'Villanueva',
        'Vipasa',
        'Vista Hermosa',
        'Yira Castro'
    );

    $tiposDirecciones = array(
        'Calle',
        'Avenida',
        'Av.',
        'Carrera',
        'Carretera',
        'Camino',
        'Diagonal',
        'Transversal',
        'Boulevard',
        'Pasaje',
        'Paseo',
        'Autopista',
        'Circunvalación',
        'Ruta',
        'Vía',
        'Sendero',
        'Vereda',
        'Callejón',
        'Plaza',
        'Plazoleta',
        'Urbanización',
        'Barrio',
        'Conjunto',
        'Residencial',
        'Sector',
        'Manzana',
        'Lote',
        'Edificio',
        'Torre',
        'Bloque',
        'Apartamento',
        'Apto.',
        'Casa',
        'Local',
        'Oficina',
        'Finca',
        'Hacienda',
        'Parcela',
        'Kilómetro',
        'Km.'
    );

    /**
     * Función para parsear una dirección existente y extraer sus componentes
     * @param string $direccion Dirección completa a parsear
     * @return array Array con 'tipo_via', 'numero_via' y 'complemento'
     */
    function parsearDireccion($direccion) {
        $resultado = array(
            'tipo_via' => '',
            'numero_via' => '',
            'complemento' => ''
        );
        
        if (empty($direccion)) {
            return $resultado;
        }
        
        $direccion = trim($direccion);
        global $tiposDirecciones;
        
        // Buscar tipo de vía al inicio
        foreach ($tiposDirecciones as $tipo) {
            $tipoLower = strtolower($tipo);
            $direccionLower = strtolower($direccion);
            
            // Verificar si la dirección comienza con el tipo de vía
            if (stripos($direccion, $tipo . ' ') === 0 || stripos($direccion, $tipo . '.') === 0) {
                $resultado['tipo_via'] = $tipo;
                // Remover el tipo de vía de la dirección
                $direccion = trim(substr($direccion, strlen($tipo)));
                // Remover punto o espacio adicional
                $direccion = ltrim($direccion, '. ');
                break;
            }
        }
        
        // Buscar complemento (generalmente después de #, Apto, Casa, etc.)
        $patronesComplemento = array(
            '/#\s*[0-9A-Za-z\-\s]+/i',  // #45-67, # 45-67
            '/Apto\.?\s*[0-9A-Za-z\-\s]+/i',  // Apto 201, Apto. 201
            '/Casa\s*[0-9A-Za-z\-\s]+/i',  // Casa 5
            '/Local\s*[0-9A-Za-z\-\s]+/i',  // Local 10
            '/Edificio\s*[0-9A-Za-z\-\s]+/i',  // Edificio A
        );
        
        $complementoEncontrado = '';
        foreach ($patronesComplemento as $patron) {
            if (preg_match($patron, $direccion, $matches)) {
                $complementoEncontrado = trim($matches[0]);
                // Remover el complemento de la dirección
                $direccion = trim(str_replace($complementoEncontrado, '', $direccion));
                break;
            }
        }
        
        // Si no se encontró con patrones, buscar después de espacios múltiples o caracteres especiales
        if (empty($complementoEncontrado)) {
            // Buscar patrones como "123 #45-67" o "123 Apto 201"
            if (preg_match('/^([^#]+?)\s+(#|Apto|Casa|Local|Edificio).+$/i', $direccion, $matches)) {
                $numeroVia = trim($matches[1]);
                $complementoEncontrado = trim(substr($direccion, strlen($numeroVia)));
                $direccion = $numeroVia;
            }
        }
        
        $resultado['complemento'] = $complementoEncontrado;
        
        // Lo que queda es el número de vía
        $resultado['numero_via'] = trim($direccion);
        
        return $resultado;
    }

?>
